<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.weet.app.user.mapper.UserMapper">
	
	<!-- ====================회원가입====================== -->
	
	<!-- T_USER  -->
    <resultMap id="UserDTO" type="com.weet.app.user.domain.UserDTO">
        <result column="user_id" property="userId" />
        <result column="user_name" property="userName" />
        <result column="user_type" property="userType" />
        <result column="user_nickname" property="userNickname" />
        <result column="user_phone" property="userPhone" />
        <result column="user_email" property="userEmail" />
        <result column="user_profile" property="userProfile" />
        <result column="user_gender" property="userGender" />
        <result column="user_svc_use_agmt_yn" property="userSvcUseAgmtYN" />
        <result column="user_svc_pcy_Agmt_yn" property="userSvcPCYAgmtYN" />
        <result column="user_recive_email_agmt_yn" property="userReciveEmailAgmtYN" />
        <result column="user_recive_sms_agmt_yn" property="userReciveSMSAgmtYN" />
    </resultMap>

    <resultMap id="TrainerDTO" type="com.weet.app.user.domain.TrainerDTO">
        <result column="user_id" property="userId" />
        <result column="user_pwd" property="userPwd" />
        <result column="user_career" property="userCareer" />
        <result column="user_intro" property="userIntro" />
        <result column="user_biz" property="userBiz" />
    </resultMap>

	<resultMap id="JoinDTO" type="com.weet.app.user.domain.JoinDTO">
        <collection property="tarinerDTO" resultMap="TarinerDTO" />
        <collection property="userDTO" resultMap="userDTO" />
    </resultMap>
    
    <!-- InsertAll 로 여러 개의 테이블에 동시에 데이터 입력 -->
    <insert id="insertTr" parameterType="com.weet.app.user.domain.JoinDTO" >
        INSERT ALL
           INTO t_tr(user_id, user_pwd, user_career, user_intro, user_biz) 
              VALUES( #{userId}, #{user_pwd}, #{user_career}, #{user_intro}, #{user_biz} )
           INTO t_user(user_id, user_name, user_type, user_nickname, user_phone, user_email, user_gender, 
                        user_svc_use_agmt_yn, user_svc_pcy_Agmt_yn, user_recive_email_agmt_yn, user_recive_sms_agmt_yn) 
              VALUES( #{user_id}, #{user_name},#{user_type},#{user_nickname}, #{user_phone}, #{user_email}, #{user_gender},
                         #{user_svc_use_agmt_yn}, #{user_svc_pcy_Agmt_yn}, #{user_recive_email_agmt_yn}, #{user_recive_sms_agmt_yn} )
        Select* FROM dual;
    </insert>
	

	<!-- 아이디 중복 체크 -->
	<select id="selectId" parameterType="com.weet.app.user.domain.TrainerVO" resultType="java.lang.Integer">
		SELECT COUNT(user_id) FROM t_tr WHERE user_id= #{user_id}
	</select>
	

	<!-- ==================== 로그인 ====================== -->
	
	<select
        id="selectUser"
        resultType="com.weet.app.user.domain.UserVO">        
        SELECT *
        FROM tbl_user
        WHERE userId = #{user_id} AND userPwd = #{user_pwd}
    </select>
    

    <select 
        id="selectUserByRememberMe"
        resultType="com.weet.app.user.domain.UserVO"> 
        SELECT userId, userPwd
        FROM tbl_user
        WHERE rememberme = #{rememberme} AND rememberage > current_date
    </select>


    <update id="updateUserWithRememberMe">
        UPDATE tbl_user
        SET
            rememberme = #{rememberMe, jdbcType=VARCHAR},
            rememberage = #{rememberAge, jdbcType=DATE}
        WHERE
            userId = #{user_id}
    </update>
	
	
</mapper>